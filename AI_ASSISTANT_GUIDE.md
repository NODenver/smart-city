# AI智能助手使用指南

## 🎯 功能概述

AI智能助手（代号"小智"）已成功集成到智慧城市平台中，基于**阿里云DashScope qwen-max大模型**，提供真正的智能对话、数据分析和预警分析功能。

### 🤖 技术特性
- **真正AI驱动**: 使用qwen-max大模型，非模拟对话
- **智能上下文**: 理解对话历史和当前数据
- **专业能力**: 智慧城市领域专业知识
- **实时分析**: 动态分析当前系统数据

## ✨ 核心功能

### 1. 智能对话
- **自然语言交互**: 支持日常聊天和问题咨询
- **真正AI理解**: 基于qwen-max大模型的深度理解能力
- **专业城市管理知识**: 智慧城市领域专业知识问答
- **上下文理解**: 理解对话历史和当前数据状态
- **智能建议**: 提供个性化、专业化的管理建议

### 2. 数据分析助手
- **事件统计分析**
  - 智能统计：总事件数、待处理、紧急事件
  - 深度分析：按类型和区域分布、模式识别
  - 趋势预测：7天趋势分析、未来预测
  - **AI洞察**: 发现数据中的隐藏模式和规律

- **传感器状态分析**
  - 实时监控：设备数量统计、异常设备监测
  - 智能评估：正常运行率计算、健康度分析
  - 分类统计：按类型分布、设备状态分布
  - **AI建议**: 预防性维护建议、异常原因分析

### 3. 预警分析助手
- **预警统计概览**
  - 智能统计：总预警数、待处理、已处理数量
  - 态势分析：预警类型分布、趋势变化
  - 优先级评估：智能排序、重点识别
  - **AI评估**: 整体风险评估、趋势预测

- **具体预警分析**
  - 深度诊断：预警原因分析、根本原因识别
  - 影响评估：影响范围、严重程度评估
  - 智能处置：AI生成的个性化处置建议
  - **AI方案**: 应急方案、预防措施、跟进建议

### 4. 智能快捷操作
- **一键数据查询**: 快速按钮直达常用功能
- **实时数据引用**: 自动获取当前页面上下文
- **自动问题路由**: 智能识别问题类型并选择最佳回答方式

## 🚀 使用方法

### 启动AI助手
1. 在任何页面右下角点击 **💬 聊天按钮**
2. 聊天窗口将从右下角滑出

### 快捷操作
点击欢迎消息中的快捷按钮：
- 📊 **分析事件数据**: 查看市民事件统计和分析
- 📡 **查看传感器状态**: 了解传感器运行情况
- ⚠️ **分析预警信息**: 查看当前预警统计

### 手动提问示例

#### 数据分析类
```
"当前有多少事件？"
"显示事件的区域分布"
"最近7天的事件趋势如何？"
"传感器有多少异常？"
"按类型统计事件"
```

#### 预警分析类
```
"当前有多少预警？"
"解释一下待处理的预警"
"预警的处理建议是什么？"
"哪些预警需要优先处理？"
```

#### 通用咨询类
```
"什么是智慧城市？"
"如何提高城市管理效率？"
"系统有哪些功能？"
```

## 🎨 界面特性

### 悬浮按钮
- 位置：右下角固定位置
- 样式：青色渐变圆形按钮
- 交互：点击展开聊天窗口
- 动画：悬停时轻微上浮效果

### 聊天窗口
- **尺寸**: 380px × 600px
- **头部**: AI头像、名称、状态指示
- **消息区**: 滚动显示聊天记录
- **输入区**: 文本输入框和发送按钮

### 消息气泡
- **用户消息**: 右侧，青色渐变背景
- **AI消息**: 左侧，深色背景带边框
- **时间戳**: 每条消息下方显示时间
- **格式化**: 支持粗体、斜体、代码高亮

### 欢迎界面
- AI头像和介绍
- 三个快捷操作按钮
- 一键直达常用功能

## 🔧 技术架构

### 核心文件
```
src/
├── services/
│   ├── chat.ts                    # AI聊天服务（真实API调用）
│   └── ai.ts                      # AI分析服务（与聊天助手同源）
├── components/
│   └── AIChat/
│       ├── AIChatAssistant.vue    # 主聊天组件
│       └── ChatMessage.vue        # 消息组件
└── views/
    └── HomeView.vue               # 主页（已集成AI助手）
```

### AI服务架构 (chat.ts)
```typescript
class ChatAIService {
  // 🚀 真实API调用：发送消息到qwen-max
  async sendMessage(message, context)

  // 🚀 智能数据查询：调用AI进行数据分析
  async queryDataInfo(query, dataStore)

  // 🚀 AI预警分析：调用AI进行预警分析
  async analyzeAlerts(alertId, dataStore)
}
```

### 🤖 AI集成方案
- **模型**: 阿里云 DashScope qwen-max
- **API端点**: `https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions`
- **调用方式**: 与AI分析功能完全一致
- **智能路由**: 自动识别问题类型并选择最佳处理方式
  1. **数据分析**: 包含"数据"、"统计"、"事件"、"传感器"等关键词
  2. **预警分析**: 包含"预警"、"警告"等关键词
  3. **通用对话**: 其他类型问题

## 🎯 使用场景

### 场景1: 数据概览查询
**用户**: "当前有多少事件？"

**AI助手**（基于真实AI分析）:
```
我来帮您分析当前的事件情况。

📊 当前市民事件统计：
- 总事件数：150 条
- 待处理：23 条（占比15.3%）
- 紧急事件：5 条（需优先处理）

📈 深度分析：

根据数据分析，我发现：

1️⃣ **主要事件类型**：
   - 道路积水：45条（30%）- 需关注排水系统
   - 路灯故障：32条（21.3%）- 影响夜间安全
   - 违停车辆：28条（18.7%）- 需加强管理

2️⃣ **区域分布**：
   - 朝阳区：38条（最集中）
   - 海淀区：35条
   - 东城区：28条

💡 **管理建议**：
- 优先处理5条紧急事件，特别是道路积水和路灯故障
- 建议在朝阳区加强巡查，预防类似问题
- 考虑在雨季前提前检查排水设施
```

### 场景2: 预警咨询
**用户**: "有哪些预警需要处理？"

**AI助手**（基于真实AI分析）:
```
⚠️ 我来为您分析当前的预警态势。

📊 预警统计概览：
- 总预警数：8 条
- 待处理：3 条（风险较高）
- 已处理：5 条

🚨 **待处理预警详情**：

1. 聚集性问题预警 - 朝阳区
   - 1小时内"道路积水"事件达5次
   - 风险等级：⚠️⚠️⚠️ 高
   - 影响范围：中等到大

2. 传感器异常预警 - 海淀区
   - 积水传感器连续3次超阈值
   - 当前值：45cm（阈值30cm）
   - 风险等级：⚠️⚠️ 中

🎯 **AI处置建议**：

**立即行动**：
1. 调度排水车前往朝阳区积水点
2. 检查海淀区传感器设备状态
3. 通知市政部门检修排水管网

**预防措施**：
- 加强对易积水区域的巡查
- 定期清理排水管网
- 建立传感器预警联动机制
```

### 场景3: 趋势分析
**用户**: "最近7天的事件趋势如何？"

**AI助手**（基于真实AI分析）:
```
📈 我来为您分析最近7天的事件趋势。

数据显示：

**日事件数量变化**：
- 11-23：18条
- 11-24：22条
- 11-25：15条
- 11-26：25条
- 11-27：30条（峰值）
- 11-28：28条
- 11-29：12条（截至目前）

🔍 **趋势分析**：

1️⃣ **整体趋势**：
   - 本周呈现"波浪式"变化
   - 11月27日达到峰值（30条）
   - 近期有所回落，但需持续观察

2️⃣ **可能原因**：
   - 11月26-27日可能有天气因素影响
   - 周末期间事件上报量增加
   - 工作日初期上报量相对较低

3️⃣ **预测**：
   - 预计未来2-3天事件量可能在15-25条之间波动
   - 如遇降雨，道路积水事件可能增加

💡 **建议**：
- 提前做好应急资源准备
- 关注天气变化对事件的影响
- 建立事件预警机制，及时响应
```
- 2025-11-23：18 条
- 2025-11-24：22 条
- 2025-11-25：15 条
- 2025-11-26：25 条
- 2025-11-27：30 条
- 2025-11-28：28 条
- 2025-11-29：12 条

总体趋势：保持平稳
```

## 📝 注意事项

1. **API配置**
   - 需要配置 `VITE_DASHSCOPE_API_KEY` 环境变量
   - 密钥可在阿里云DashScope控制台获取

2. **网络要求**
   - 需要稳定的网络连接
   - API调用可能产生少量费用

3. **使用限制**
   - 单次回复最多1000字符
   - 建议一次提问一个明确问题

4. **数据引用**
   - AI助手会自动引用当前页面数据
   - 数据是实时的，反映最新状态

## 🎉 优势特点

✅ **智能识别**: 自动识别问题类型，选择最佳回答方式
✅ **实时数据**: 直接查询系统实时数据，无需手动统计
✅ **专业建议**: AI提供专业的城市管理建议
✅ **便捷操作**: 一键快捷操作，快速获取信息
✅ **上下文理解**: 可以结合当前页面数据回答问题
✅ **美观界面**: 现代化的聊天界面设计
✅ **响应式**: 完美适配桌面和移动端

## 🚀 快速开始

1. 访问 http://localhost:5179/
2. 点击右下角聊天按钮
3. 点击快捷操作或直接提问
4. 享受AI助手的智能服务！

---

AI智能助手让智慧城市管理变得更加简单和高效！🎊
