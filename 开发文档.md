# 智慧城市运行态势感知系统 - 开发文档

## 1. 项目概述

### 1.1 项目背景

本项目是面向城市管理人员的运行态势感知与智能辅助决策平台，旨在通过前端技术栈、大模型 API 与数据可视化手段，实现多源数据接入、实时态势展示、AI智能分析、决策建议生成等功能。

### 1.2 项目信息

- **项目名称**: 智慧城市运行态势感知系统
- **技术栈**: Vue 3 + TypeScript + Vite
- **UI 框架**: Element Plus
- **状态管理**: Pinia
- **图表库**: ECharts
- **构建工具**: Vite 7.2.4
- **开发语言**: TypeScript 5.9.0

### 1.3 核心功能

✅ **已实现功能**
- 多源数据导入与结构化展示（JSON文件上传）
- AI智能分析与建议生成（支持阿里云通义千问）
- 城市运行态势大屏（多种图表可视化）
- 智能预警与处置跟踪
- AI对话助手
- 自动生成处置日报（PDF导出）
- 多维筛选与对比
- 实时数据模拟与预警检测

### 1.4 设计规范

#### 1.4.1 UI设计参考

本项目的UI设计基于Figma设计系统，实现了专业的数据可视化大屏界面：

- **Figma设计文件**: [在此项目的智慧城市UI设计文件夹]
- **设计分辨率**: 1920×1080（标准大屏分辨率）
- **设计工具**: Figma + Vectary + Illustrator
- **设计风格**: 科技感、数据可视化、深色主题

#### 1.4.2 视觉设计特点

1. **深色科技主题**
   - 主背景色：深蓝灰 (#1a1a2e)
   - 卡片背景：半透明深色 (rgba(26, 26, 46, 0.6))
   - 强调色：亮蓝/青色 (#00d4ff, #409eff)
   - 文字色：高对比度白色 (#e4e4e7)

2. **数据可视化设计**
   - 图表配色：渐变色方案
   - 状态指示：红（异常）、黄（警告）、绿（正常）、蓝（信息）
   - 动画效果：平滑过渡、渐进加载
   - 响应式布局：支持1920×1080及以上分辨率

3. **交互设计**
   - 鼠标悬停效果：高亮边框、阴影提升
   - 点击反馈：波纹动画、颜色变化
   - 加载状态：骨架屏、进度条
   - 过渡动画：300ms缓动效果

#### 1.4.3 组件设计规范

| 组件类型 | 尺寸规范 | 圆角 | 间距 | 阴影 |
|---------|---------|------|------|------|
| 卡片 | 自适应 | 8px | 16px/24px | 0 4px 12px rgba(0,0,0,0.3) |
| 按钮 | 高度40px | 6px | 16px/32px | 0 2px 8px rgba(0,0,0,0.2) |
| 图表 | 自适应 | 4px | 16px | 0 2px 8px rgba(0,0,0,0.2) |
| 输入框 | 高度40px | 6px | 12px | inset 0 2px 4px rgba(0,0,0,0.1) |

#### 1.4.4 图标系统

- **图标库**: Element Plus Icons + 自定义SVG图标
- **图标尺寸**: 16px / 20px / 24px / 32px
- **图标风格**: 线性图标（outline）+ 实心图标（filled）
- **颜色规范**: 继承父级文字颜色，支持状态色（success/warning/danger/info）

#### 1.4.5 字体规范

- **中文字体**: "PingFang SC", "Microsoft YaHei", sans-serif
- **英文字体**: "Helvetica Neue", Arial, sans-serif
- **数字字体**: "Roboto Mono", "Consolas", monospace（等宽字体用于数据展示）

| 文字类型 | 字体大小 | 字重 | 行高 | 用途 |
|---------|---------|------|------|------|
| 大标题 | 32px | 600 | 1.2 | 页面标题 |
| 中标题 | 24px | 600 | 1.3 | 区块标题 |
| 小标题 | 18px | 600 | 1.4 | 组件标题 |
| 正文 | 14px | 400 | 1.5 | 普通文本 |
| 辅助文字 | 12px | 400 | 1.5 | 标签、提示 |
| 数据大屏 | 48px | 700 | 1.2 | 关键指标数字 |

## 2. 技术架构

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                     前端展示层                           │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │
│  │ HomeView │ │ Dashboard│ │AnalysisView││AlertsView│   │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │
└─────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────┐
│                   业务组件层                             │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │
│  │AIAssistant││DataPanel ││FilterSec ││AlertsPanel│   │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │
└─────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────┐
│                   状态管理层                             │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │
│  │useDataStore││useAIStore ││useAlertStore││  router  │   │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │
└─────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────┐
│                   数据服务层                             │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │
│  │   AI服务  │ │  Chat服务 │ │ Mock数据  │ │ API接口  │   │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │
└─────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────┐
│                   外部依赖                               │
│     阿里云DashScope API    │     ECharts图表库          │
└─────────────────────────────────────────────────────────┘
```

### 2.2 技术选型说明

| 技术组件 | 版本 | 选择理由 |
|---------|------|----------|
| Vue 3 | 3.5.25 | 组合式API、性能更优、TypeScript支持良好 |
| TypeScript | 5.9.0 | 类型安全、更好的开发体验 |
| Vite | 7.2.4 | 快速的构建工具、HMR热更新 |
| Element Plus | 2.11.8 | Vue 3生态成熟UI组件库 |
| Pinia | 3.0.4 | Vue 3推荐状态管理库 |
| ECharts | 6.0.0 | 功能强大的数据可视化库 |
| Axios | 1.13.2 | HTTP请求库 |
| jsPDF | 3.0.4 | PDF导出功能 |
| html2canvas | 1.4.1 | 页面截图功能 |

## 3. 项目结构

```
smart-city/
├── public/                      # 静态资源
├── src/
│   ├── assets/                  # 静态资源
│   │   ├── main.css            # 全局样式
│   │   ├── base.css            # 基础样式
│   │   ├── theme.css           # 主题样式
│   │   ├── components.css      # 组件样式
│   │   ├── fix-text.css        # 文本修正样式
│   │   ├── force-override.css  # 强制覆盖样式
│   │   └── maps/               # 地图数据
│   │       ├── china.js        # 中国地图配置
│   │       └── 北京.json       # 北京市地图数据
│   ├── components/             # 公共组件
│   │   └── AIChat/             # AI聊天组件
│   │       ├── AIChatAssistant.vue
│   │       └── ChatMessage.vue
│   ├── router/                 # 路由配置
│   │   └── index.ts
│   ├── services/               # 服务层
│   │   ├── ai.ts               # AI分析服务
│   │   └── chat.ts             # 聊天服务
│   ├── stores/                 # Pinia状态管理
│   │   ├── data.ts             # 数据存储
│   │   ├── ai.ts               # AI分析存储
│   │   └── alert.ts            # 预警存储
│   ├── styles/                 # 样式目录
│   ├── types/                  # TypeScript类型定义
│   │   └── city.ts             # 城市数据类型
│   ├── views/                  # 页面视图
│   │   ├── HomeView.vue        # 首页
│   │   ├── DashboardView.vue   # 大屏视图
│   │   ├── AnalysisView.vue    # AI分析视图
│   │   ├── DataListView.vue    # 数据列表视图
│   │   ├── AlertsView.vue      # 预警列表视图
│   │   ├── FilterView.vue      # 筛选视图
│   │   ├── AboutView.vue       # 关于页面
│   │   └── panels/             # 功能面板
│   │       ├── DataUploadPanel.vue
│   │       ├── DataOverviewPanel.vue
│   │       ├── DashboardPanel.vue
│   │       ├── AnalysisPanel.vue
│   │       ├── AlertsPanel.vue
│   │       └── FilterSection.vue
│   ├── App.vue                 # 根组件
│   └── main.ts                 # 入口文件
├── city_events.json            # 市民事件模拟数据
├── sensor_data.json            # 传感器数据模拟数据
├── index.html                  # HTML模板
├── vite.config.ts              # Vite配置
├── tsconfig.json               # TypeScript配置
├── tsconfig.app.json           # 应用TS配置
├── tsconfig.node.json          # Node TS配置
├── eslint.config.ts            # ESLint配置
├── env.d.ts                    # 环境类型声明
├── package.json                # 依赖配置
└── 开发文档.md                 # 开发文档（本文档）
```

## 4. 核心功能实现

### 4.1 数据管理（DataStore）

**文件位置**: `src/stores/data.ts`

**功能说明**:
- 管理城市事件数据（CityEvent[]）
- 管理传感器数据（SensorData[]）
- 提供数据统计计算属性
- 实现数据自动生成与预警检测

**核心状态**:
```typescript
cityEvents: CityEvent[]           // 城市事件数据
sensorData: SensorData[]          // 传感器数据
currentView: 'all'|'events'|'sensors'  // 当前视图模式
isAutoGenerating: boolean         // 自动生成状态
alerts: Alert[]                   // 预警列表
alertRules: AlertRule             // 预警规则配置
```

**关键方法**:
- `loadCityEvents(events)`: 加载城市事件数据
- `loadSensorData(sensors)`: 加载传感器数据
- `generateNewData()`: 生成新数据（模拟实时数据）
- `checkClusterEvents(event)`: 检测聚集性事件预警
- `checkSensorAnomaly(sensor)`: 检测传感器异常预警

**预警规则**:
- 聚集性事件：同一区域1小时内≥5次同类事件触发预警
- 传感器异常：连续3次超过阈值触发预警

### 4.2 AI分析（AIStore）

**文件位置**: `src/stores/ai.ts` 和 `src/services/ai.ts`

**功能说明**:
- 管理AI分析历史记录
- 支持流式AI分析
- 集成阿里云通义千问API
- 提供模拟AI响应（降级方案）

**核心状态**:
```typescript
analysisHistory: AIAnalysisResult[]  // 分析历史
isAnalyzing: boolean                 // 分析状态
currentStream: string               // 流式输出内容
API_KEY: string                     // API密钥
```

**关键方法**:
- `analyzeStreaming(events, sensors)`: 流式分析
- `analyzeWithAPI(events, sensors)`: 调用真实API
- `analyzeWithMock(events, sensors)`: 模拟分析（降级）
- `buildPrompt(events, sensors)`: 构建分析提示词

**AI分析流程**:
1. 接收城市事件和传感器数据
2. 构建结构化提示词
3. 调用阿里云DashScope API（或使用模拟响应）
4. 流式输出分析进度
5. 解析返回结果（问题归因、处置建议、优先级）
6. 保存分析历史

**API配置**:
```typescript
API_ENDPOINT: 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions'
MODEL: 'qwen-max'
```

### 4.3 数据可视化大屏（Dashboard）

**文件位置**: `src/views/DashboardView.vue` 和 `src/views/panels/DashboardPanel.vue`

**功能说明**:
- 展示城市运行态势总览
- 实时数据监控
- 多种图表可视化

**可视化组件**:
1. **关键指标卡片**
   - 今日事件数
   - 异常设备数
   - 高优先级问题数
   - 平均响应时长

2. **城市问题热力图**
   - 基于地理坐标
   - ECharts热力图组件
   - 展示问题分布密度

3. **问题类型环形图**
   - 事件类型统计
   - 传感器异常分类
   - 对比分析

4. **实时事件滚动列表**
   - 每10秒模拟新增数据
   - NEW标识高亮
   - 自动滚动

5. **趋势折线图**
   - 近7天问题数量变化
   - ECharts折线图
   - 支持交互缩放

**图表配置示例**:
```typescript
const chartOptions = {
  title: { text: '城市事件趋势', left: 'center' },
  tooltip: { trigger: 'axis' },
  xAxis: { type: 'category', data: trendData.dates },
  yAxis: { type: 'value' },
  series: [{
    data: trendData.counts,
    type: 'line',
    smooth: true,
    areaStyle: {}
  }]
};
```

### 4.4 数据上传与管理

**文件位置**: `src/views/panels/DataUploadPanel.vue`

**功能说明**:
- 支持拖拽或点击上传JSON文件
- 自动校验数据格式
- 错误友好提示
- 合并展示事件和传感器数据

**支持的数据格式**:
```typescript
// 城市事件数据
interface CityEvent {
  id: string;                      // 事件ID
  type: string;                    // 事件类型
  description: string;             // 事件描述
  location: {                      // 地理位置
    district: string;              // 区域
    street: string;                // 街道
    lat: number;                   // 纬度
    lng: number;                   // 经度
  };
  reportTime: string;              // 上报时间
  reporterType: string;            // 上报人类型
  status: '未处理'|'处理中'|'已派单'|'紧急'|'核查中';
}

// 传感器数据
interface SensorData {
  sensorId: string;                // 传感器ID
  type: string;                    // 传感器类型
  location: {                      // 地理位置
    district: string;
    street: string;
    lat: number;
    lng: number;
  };
  value: number;                   // 当前值
  unit: string;                    // 单位
  threshold: number;               // 阈值
  timestamp: string;               // 时间戳
  status: '正常'|'异常';           // 状态
}
```

### 4.5 AI对话助手

**文件位置**: `src/components/AIChat/AIChatAssistant.vue`

**功能说明**:
- 集成聊天窗口
- 支持自然语言查询
- 基于当前数据回答
- 支持上下文记忆

**示例对话**:
```
用户: "今天哪些区域积水最严重？"
AI: "根据当前数据分析，朝阳区建国路和海淀区中关村大街的积水问题较为突出。建议重点关注这两个区域的排水系统..."

用户: "列出所有高优先级的路灯故障"
AI: "当前系统中共有3个高优先级路灯故障：
1. 西直门外大街 - 状态：紧急
2. 复兴门内大街 - 状态：已派单
3. 建议优先处理..."
```

### 4.6 预警系统

**文件位置**: `src/stores/alert.ts` 和 `src/views/panels/AlertsPanel.vue`

**功能说明**:
- 自动预警检测
- 预警规则配置
- 预警状态管理
- 处置建议关联

**预警类型**:
1. **聚集性事件预警**
   - 规则：同一区域1小时内≥5次同类事件
   - 通知：Toast弹窗 + 侧边栏列表
   - 操作：标记已处理、查看详情

2. **传感器异常预警**
   - 规则：连续3次超过阈值
   - 通知：实时弹窗提醒
   - 操作：设备维护派单

**预警数据结构**:
```typescript
interface Alert {
  id: string;                      // 预警ID
  ruleId: string;                  // 规则ID
  ruleName: string;                // 规则名称
  eventCount: number;              // 事件数量
  location: string;                // 位置信息
  timestamp: string;               // 触发时间
  status: 'pending'|'processed'|'following'; // 状态
  suggestion?: string;             // AI建议
}
```

## 5. 开发指南

### 5.1 环境要求

- Node.js: >=20.19.0 或 >=22.12.0
- 包管理器: npm 或 yarn

### 5.2 安装依赖

```bash
npm install
# 或
yarn install
```

### 5.3 开发模式

```bash
npm run dev
# 或
yarn dev
```

### 5.4 构建生产版本

```bash
npm run build
# 或
yarn build
```

### 5.5 代码检查

```bash
npm run lint
# 或
yarn lint
```

### 5.6 类型检查

```bash
npm run type-check
# 或
yarn type-check
```

## 6. API配置

### 6.1 环境变量配置

创建 `.env` 文件并配置以下变量：

```env
# 阿里云DashScope API Key
VITE_DASHSCOPE_API_KEY=your_api_key_here

# API Endpoint（可选，默认已配置）
VITE_DASHSCOPE_ENDPOINT=https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions

# 模型名称（可选，默认qwen-max）
VITE_DASHSCOPE_MODEL=qwen-max
```

### 6.2 获取API Key

1. 访问 [阿里云DashScope控制台](https://dashscope.console.aliyun.com/)
2. 创建应用并获取API Key
3. 将API Key配置到 `.env` 文件中

### 6.3 API调用说明

系统支持两种AI分析模式：

1. **真实API模式**（需配置API Key）
   - 调用阿里云DashScope API
   - 返回真实AI分析结果
   - 支持流式输出

2. **模拟模式**（无API Key时自动启用）
   - 使用内置模拟响应
   - 模拟流式输出过程
   - 生成合理的分析结果

## 7. 数据模拟说明

### 7.1 自动数据生成

系统提供自动数据生成功能，用于模拟实时城市数据：

**启动方式**:
- 在数据列表页面点击"启动自动生成"按钮
- 系统将每20-30秒随机生成一条新数据

**生成规则**:
- 50%概率生成市民事件
- 50%概率生成传感器数据
- 30%传感器数据为异常状态
- 自动触发预警检测

### 7.2 Mock数据文件

**city_events.json**: 包含90条模拟市民事件数据
- 事件类型：道路积水、路灯故障、占道经营、噪音扰民等
- 覆盖区域：北京市各区县
- 状态：未处理、处理中、已派单、紧急、核查中

**sensor_data.json**: 包含60条模拟传感器数据
- 传感器类型：积水传感器、空气质量、噪音监测等
- 监测指标：数值、阈值、状态（正常/异常）
- 实时时间戳

## 8. 页面路由

### 8.1 路由配置

```typescript
// src/router/index.ts

const routes = [
  { path: '/', name: 'home', component: HomeView },
  { path: '/datalist', name: 'datalist', component: DataListView },
  { path: '/dashboard', name: 'dashboard', component: DashboardView },
  { path: '/analysis', name: 'analysis', component: AnalysisView },
  { path: '/filter', name: 'filter', component: FilterView },
  { path: '/alerts', name: 'alerts', component: AlertsView },
  { path: '/about', name: 'about', component: AboutView }
];
```

### 8.2 页面说明

| 路由 | 页面名称 | 功能说明 | Figma设计参考 |
|------|----------|----------|---------------|
| / | 首页 | 系统概览、快速入口 | [首页设计Frame-1](https://figma.com) |
| /datalist | 数据列表 | 查看所有事件和传感器数据，支持筛选 | [数据列表Frame-2](https://figma.com) |
| /dashboard | 态势大屏 | 数据可视化大屏，实时监控 | [大屏设计Frame-3](https://figma.com) |
| /analysis | AI分析 | AI智能分析与建议生成 | [AI分析Frame-4](https://figma.com) |
| /filter | 数据筛选 | 多维条件筛选与对比 | [筛选页Frame-5](https://figma.com) |
| /alerts | 预警中心 | 查看和管理预警信息 | [预警中心Frame-6](https://figma.com) |
| /about | 关于 | 项目信息和技术说明 | [关于页Frame-7](https://figma.com) |

#### 8.3 Figma设计页面说明

**完整Figma设计文件**: [智慧城市运行态势感知系统-UI设计](https://figma.com/file/xxx)

**设计文件结构**:

```
📁 智慧城市UI设计
├── 📁 1. 设计系统
│   ├── 🎨 颜色规范 (Colors)
│   ├── 🔤 字体规范 (Typography)
│   ├── 📐 间距规范 (Spacing)
│   ├── 🔘 组件库 (Components)
│   └── 🖼️ 图标库 (Icons)
│
├── 📁 2. 页面设计
│   ├── 首页 (Home Page)
│   ├── 态势大屏 (Dashboard)
│   ├── 数据列表 (Data List)
│   ├── AI分析 (AI Analysis)
│   ├── 数据筛选 (Data Filter)
│   ├── 预警中心 (Alerts)
│   └── 关于页面 (About)
│
├── 📁 3. 组件设计
│   ├── 卡片组件 (Cards)
│   ├── 图表组件 (Charts)
│   ├── 按钮组件 (Buttons)
│   ├── 表单组件 (Forms)
│   └── 弹窗组件 (Modals)
│
└── 📁 4. 交互动效
    ├── 过渡动画 (Transitions)
    ├── 加载动画 (Loading)
    ├── 悬停效果 (Hover)
    └── 微交互 (Micro-interactions)
```

**设计规范要点**:

- **网格系统**: 12列网格，24px列间距，40px页边距
- **断点设置**: 1920×1080（主）、2560×1440（宽屏）
- **组件状态**: 默认、悬停、激活、禁用、加载
- **响应式**: 采用弹性布局，适配不同分辨率

**主要设计页面**:

1. **首页设计** (`Frame-1`)
   - 顶部导航栏 (80px高度)
   - 快速入口卡片网格 (3×2布局)
   - 底部信息栏 (60px高度)
   - 背景：渐变深色 + 动态粒子效果

2. **态势大屏设计** (`Frame-3`)
   - 1920×1080标准大屏尺寸
   - 顶部KPI指标卡片 (4个等宽卡片)
   - 左侧城市地图 (热力图)
   - 右侧图表区域 (2×2网格)
   - 底部事件滚动列表

3. **AI分析页面** (`Frame-4`)
   - 左侧数据选择区 (30%宽度)
   - 右侧分析结果区 (70%宽度)
   - 流式输出展示区
   - 历史记录侧边栏

4. **预警中心页面** (`Frame-6`)
   - 预警规则配置区 (顶部)
   - 预警列表 (主内容区)
   - 预警详情抽屉 (右侧)
   - 状态标签筛选 (左侧边栏)

## 9. 状态管理

### 9.1 Pinia Store

项目使用Pinia作为状态管理工具，包含以下Store：

**useDataStore** (`src/stores/data.ts`)
- 管理城市事件和传感器数据
- 数据统计和计算
- 预警规则配置
- 数据生成逻辑

**useAIStore** (`src/stores/ai.ts`)
- 管理AI分析历史
- AI分析状态控制
- 流式输出管理
- API密钥配置

**useAlertStore** (`src/stores/alert.ts`)
- 管理预警信息
- 预警状态更新
- 处置记录

### 9.2 使用示例

```typescript
// 在组件中使用DataStore
import { useDataStore } from '@/stores/data';

const dataStore = useDataStore();

// 读取数据
console.log(dataStore.cityEvents);
console.log(dataStore.totalEvents);

// 修改数据
dataStore.loadCityEvents(newEvents);

// 启动数据生成
dataStore.startAutoGenerate();
```

## 10. 样式系统

### 10.1 CSS架构

采用分层CSS架构：

```
src/assets/
├── main.css          # 入口样式，导入其他样式
├── base.css          # 基础样式，重置和通用样式
├── theme.css         # 主题样式，CSS变量定义
├── components.css    # 组件样式，Element Plus覆盖
├── fix-text.css      # 文本修正
└── force-override.css # 强制覆盖样式
```

### 10.2 主题配置

#### 10.2.1 Figma设计系统实现

项目严格遵循Figma设计系统的视觉规范，所有样式均可追溯到设计文件。

#### 10.2.2 颜色系统

在 `theme.css` 中定义CSS变量（基于Figma颜色规范）：

```css
:root {
  /* 主色调 - 来自Figma Design System */
  --primary-color: #409eff;
  --primary-light: #66b1ff;
  --primary-dark: #337ecc;

  /* 状态色 - 来自Figma Status Colors */
  --success-color: #67c23a;    /* 正常/成功 */
  --warning-color: #e6a23c;    /* 警告 */
  --danger-color: #f56c6c;     /* 异常/危险 */
  --info-color: #909399;       /* 信息/中性 */

  /* 背景色 - 来自Figma Dark Theme */
  --bg-primary: #1a1a2e;       /* 主背景 */
  --bg-secondary: #16213e;     /* 次背景 */
  --bg-tertiary: #0f3460;      /* 三级背景 */

  /* 卡片背景 - 来自Figma Surface Colors */
  --card-bg: rgba(26, 26, 46, 0.6);
  --card-bg-hover: rgba(26, 26, 46, 0.8);

  /* 文字色 - 来自Figma Text Colors */
  --text-primary: #e4e4e7;     /* 主要文字 */
  --text-secondary: #a1a1aa;   /* 次要文字 */
  --text-tertiary: #71717a;    /* 三级文字 */
  --text-disabled: #52525b;    /* 禁用文字 */

  /* 边框色 - 来自Figma Border Colors */
  --border-color: #27272a;
  --border-light: #3f3f46;
  --border-focus: #409eff;

  /* 特殊效果 - 来自Figma Effects */
  --glow-primary: #00d4ff;     /* 主荧光色 */
  --glow-secondary: #409eff;   /* 次荧光色 */
  --shadow-card: 0 4px 12px rgba(0, 0, 0, 0.3);
  --shadow-button: 0 2px 8px rgba(0, 0, 0, 0.2);
}
```

#### 10.2.3 颜色使用规范

| 颜色变量 | Figma设计 | 使用场景 | 示例 |
|---------|-----------|----------|------|
| `--primary-color` | Primary/500 | 主要按钮、链接 | 提交按钮、导航高亮 |
| `--success-color` | Success/500 | 正常状态、成功提示 | 设备正常、处理完成 |
| `--warning-color` | Warning/500 | 警告状态 | 预警提示、待处理 |
| `--danger-color` | Danger/500 | 危险状态、异常 | 设备异常、错误提示 |
| `--bg-primary` | Dark/900 | 主背景 | 页面背景 |
| `--text-primary` | Text/Primary | 主要文字 | 标题、正文 |
| `--card-bg` | Surface/Glass | 卡片背景 | 数据卡片、图表容器 |

#### 10.2.4 字体系统

基于Figma Typography规范实现：

```css
/* 字体族定义 - 来自Figma Font Families */
:root {
  --font-chinese: "PingFang SC", "Microsoft YaHei", "Hiragino Sans GB", sans-serif;
  --font-english: "Helvetica Neue", Arial, sans-serif;
  --font-mono: "Roboto Mono", "Consolas", "Monaco", monospace;
}

/* 字体大小 - 来自Figma Type Scale */
:root {
  --font-size-xs: 12px;   /* 辅助文字、标签 */
  --font-size-sm: 14px;   /* 正文 */
  --font-size-base: 16px; /* 大正文 */
  --font-size-lg: 18px;   /* 小标题 */
  --font-size-xl: 24px;   /* 中标题 */
  --font-size-2xl: 32px;  /* 大标题 */
  --font-size-3xl: 48px;  /* 数据大屏数字 */
}

/* 字重 - 来自Figma Font Weights */
:root {
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;
}

/* 行高 - 来自Figma Line Heights */
:root {
  --line-height-tight: 1.2;
  --line-height-snug: 1.3;
  --line-height-normal: 1.5;
  --line-height-relaxed: 1.6;
}
```

**字体应用示例**:

```css
/* 页面主标题 - 对应Figma Heading 1 */
.page-title {
  font-family: var(--font-chinese);
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-tight);
  color: var(--text-primary);
}

/* 数据大屏数字 - 对应Figma Display Number */
.dashboard-number {
  font-family: var(--font-mono);
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  line-height: var(--line-height-tight);
  color: var(--glow-primary);
}
```

#### 10.2.5 间距系统

遵循Figma 8pt网格系统：

```css
/* 间距刻度 - 来自Figma Spacing Scale */
:root {
  --space-0: 0;
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-5: 20px;
  --space-6: 24px;
  --space-8: 32px;
  --space-10: 40px;
  --space-12: 48px;
  --space-16: 64px;
  --space-20: 80px;
}

/* 组件间距规范 */
:root {
  --spacing-xs: var(--space-2);  /* 8px - 紧凑间距 */
  --spacing-sm: var(--space-3);  /* 12px - 小间距 */
  --spacing-md: var(--space-4);  /* 16px - 中等间距 */
  --spacing-lg: var(--space-6);  /* 24px - 大间距 */
  --spacing-xl: var(--space-8);  /* 32px - 超大间距 */
}

/* 使用示例 */
.card {
  padding: var(--spacing-lg);           /* 24px内边距 */
  margin-bottom: var(--spacing-md);     /* 16px外边距 */
  gap: var(--spacing-sm);               /* 12px元素间距 */
}
```

#### 10.2.6 圆角系统

基于Figma Corner Radius规范：

```css
:root {
  --radius-none: 0;
  --radius-xs: 2px;    /* 小圆角 - 标签 */
  --radius-sm: 4px;    /* 小圆角 - 输入框 */
  --radius-md: 6px;    /* 中圆角 - 按钮 */
  --radius-lg: 8px;    /* 大圆角 - 卡片 */
  --radius-xl: 12px;   /* 超大圆角 - 大容器 */
  --radius-full: 9999px; /* 圆形 */
}

/* 组件圆角规范 */
:root {
  --radius-button: var(--radius-md);    /* 6px */
  --radius-card: var(--radius-lg);      /* 8px */
  --radius-input: var(--radius-sm);     /* 4px */
  --radius-modal: var(--radius-xl);     /* 12px */
}
```

#### 10.2.7 阴影系统

来自Figma Effects规范：

```css
:root {
  /* 卡片阴影 - 来自Figma Shadow/Medium */
  --shadow-card: 0 4px 12px rgba(0, 0, 0, 0.3);

  /* 按钮阴影 - 来自Figma Shadow/Small */
  --shadow-button: 0 2px 8px rgba(0, 0, 0, 0.2);

  /* 浮层阴影 - 来自Figma Shadow/Large */
  --shadow-dropdown: 0 8px 24px rgba(0, 0, 0, 0.4);

  /* 内阴影 - 来自Figma Inner Shadow */
  --shadow-inset: inset 0 2px 4px rgba(0, 0, 0, 0.1);

  /* 荧光效果 - 来自Figma Glow */
  --glow-primary: 0 0 20px rgba(0, 212, 255, 0.5);
  --glow-secondary: 0 0 16px rgba(64, 158, 255, 0.4);
}

/* 组件阴影应用 */
:root {
  --shadow-card-default: var(--shadow-card);
  --shadow-card-hover: 0 6px 16px rgba(0, 0, 0, 0.35);
  --shadow-button-default: var(--shadow-button);
  --shadow-button-active: 0 1px 4px rgba(0, 0, 0, 0.3);
}
```

#### 10.2.8 动画系统

基于Figma Smart Animate规范：

```css
:root {
  /* 过渡时间 - 来自Figma Duration */
  --duration-fast: 150ms;    /* 快速交互 */
  --duration-normal: 300ms;  /* 标准过渡 */
  --duration-slow: 500ms;    /* 慢速过渡 */
  --duration-slower: 700ms;  /* 最慢过渡 */

  /* 缓动函数 - 来自Figma Easing */
  --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-in: cubic-bezier(0.4, 0, 1, 1);
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-spring: cubic-bezier(0.68, -0.55, 0.265, 1.55);

  /* 标准过渡组合 */
  --transition-fast: var(--duration-fast) var(--ease-out);
  --transition-normal: var(--duration-normal) var(--ease-out);
  --transition-slow: var(--duration-slow) var(--ease-out);
}

/* 动画应用示例 */
.button {
  transition: var(--transition-normal);
}

.button:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-button-hover);
}
```

### 10.3 深色主题

大屏界面采用深色科技感主题：
- 背景色：深蓝/深灰
- 强调色：亮蓝/青色
- 文字色：高对比度白色
- 图表：渐变色配色方案

### 10.4 Design Token 实现

#### 10.4.1 Design Token 概述

Design Token 是设计系统的核心，它将设计决策抽象为可复用的变量，实现设计与开发的同步。

**Figma → 代码映射关系**:

```
Figma Design System
│
├── Colors (颜色)
│   ├── Primary/500 → --primary-color
│   ├── Success/500 → --success-color
│   └── Dark/900 → --bg-primary
│
├── Typography (字体)
│   ├── Heading 1 → --font-size-2xl
│   ├── Body → --font-size-sm
│   └── Display → --font-size-3xl
│
├── Spacing (间距)
│   ├── XS → --spacing-xs
│   ├── MD → --spacing-md
│   └── XL → --spacing-xl
│
├── Effects (效果)
│   ├── Shadow/Medium → --shadow-card
│   └── Glow/Primary → --glow-primary
│
└── Animation (动画)
    ├── Fast → --transition-fast
    └── Normal → --transition-normal
```

#### 10.4.2 Token 文件结构

```
src/styles/
├── tokens/
│   ├── colors.css      # 颜色 Token（来自Figma Colors）
│   ├── typography.css  # 字体 Token（来自Figma Typography）
│   ├── spacing.css     # 间距 Token（来自Figma Spacing）
│   ├── radius.css      # 圆角 Token（来自Figma Corner Radius）
│   ├── shadow.css      # 阴影 Token（来自Figma Effects）
│   ├── animation.css   # 动画 Token（来自Figma Smart Animate）
│   └── index.css       # 统一导出
└── theme.css           # 主主题文件
```

#### 10.4.3 颜色 Token 完整定义

**从 Figma Design System 导出**:

```css
/* colors.css - Design Tokens for Colors */

:root {
  /* === Brand Colors (品牌色) === */
  --color-brand-primary: #409eff;
  --color-brand-secondary: #00d4ff;
  --color-brand-tertiary: #337ecc;

  /* === Semantic Colors (语义化颜色) === */
  /* 成功状态 */
  --color-success-50: #f0f9ff;
  --color-success-100: #e0f2fe;
  --color-success-500: #67c23a;
  --color-success-900: #14532d;

  /* 警告状态 */
  --color-warning-50: #fffbeb;
  --color-warning-100: #fef3c7;
  --color-warning-500: #e6a23c;
  --color-warning-900: #78350f;

  /* 危险状态 */
  --color-danger-50: #fef2f2;
  --color-danger-100: #fee2e2;
  --color-danger-500: #f56c6c;
  --color-danger-900: #7f1d1d;

  /* 信息状态 */
  --color-info-50: #f5f5f5;
  --color-info-100: #e5e5e5;
  --color-info-500: #909399;
  --color-info-900: #404040;

  /* === Neutral Colors (中性色) === */
  --color-neutral-0: #ffffff;
  --color-neutral-50: #fafafa;
  --color-neutral-100: #f5f5f5;
  --color-neutral-200: #e5e5e5;
  --color-neutral-300: #d4d4d4;
  --color-neutral-400: #a1a1aa;
  --color-neutral-500: #71717a;
  --color-neutral-600: #52525b;
  --color-neutral-700: #3f3f46;
  --color-neutral-800: #27272a;
  --color-neutral-900: #18181b;

  /* === Background Colors (背景色) === */
  --color-bg-primary: var(--color-neutral-900);
  --color-bg-secondary: #16213e;
  --color-bg-tertiary: #0f3460;
  --color-bg-glass: rgba(26, 26, 46, 0.6);

  /* === Text Colors (文字色) === */
  --color-text-primary: #e4e4e7;
  --color-text-secondary: #a1a1aa;
  --color-text-tertiary: #71717a;
  --color-text-disabled: #52525b;
  --color-text-inverse: #ffffff;

  /* === Border Colors (边框色) === */
  --color-border-default: #27272a;
  --color-border-light: #3f3f46;
  --color-border-focus: var(--color-brand-primary);

  /* === Chart Colors (图表色) === */
  --color-chart-1: #409eff;
  --color-chart-2: #00d4ff;
  --color-chart-3: #67c23a;
  --color-chart-4: #e6a23c;
  --color-chart-5: #f56c6c;
  --color-chart-gradient: linear-gradient(135deg, #00d4ff 0%, #409eff 100%);
}
```

#### 10.4.4 组件 Token 应用示例

**基于 Design Token 的组件样式**:

```css
/* Button Component - 完全基于 Design Tokens */

:root {
  /* Button Tokens */
  --button-height: 40px;
  --button-padding-x: 16px;
  --button-padding-y: 10px;
  --button-radius: var(--radius-md);
  --button-font-size: var(--font-size-sm);
  --button-font-weight: var(--font-weight-medium);
  --button-transition: var(--transition-normal);

  /* Primary Button */
  --button-primary-bg: var(--color-brand-primary);
  --button-primary-hover-bg: var(--color-brand-primary-dark);
  --button-primary-text: var(--color-text-inverse);
  --button-primary-shadow: var(--shadow-button);

  /* Secondary Button */
  --button-secondary-bg: transparent;
  --button-secondary-border: var(--color-border-default);
  --button-secondary-text: var(--color-text-primary);
  --button-secondary-hover-bg: var(--color-neutral-800);

  /* Success Button */
  --button-success-bg: var(--color-success-500);
  --button-success-hover-bg: #529b2e;
  --button-success-text: var(--color-text-inverse);
}

/* 按钮组件实现 */
.btn {
  height: var(--button-height);
  padding: var(--button-padding-y) var(--button-padding-x);
  border-radius: var(--button-radius);
  font-size: var(--button-font-size);
  font-weight: var(--button-font-weight);
  transition: var(--button-transition);
  cursor: pointer;
  border: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
}

.btn--primary {
  background: var(--button-primary-bg);
  color: var(--button-primary-text);
  box-shadow: var(--button-primary-shadow);
}

.btn--primary:hover {
  background: var(--button-primary-hover-bg);
  transform: translateY(-1px);
}

.btn--secondary {
  background: var(--button-secondary-bg);
  border: 1px solid var(--button-secondary-border);
  color: var(--button-secondary-text);
}

.btn--secondary:hover {
  background: var(--button-secondary-hover-bg);
}
```

#### 10.4.5 与 Figma 同步机制

**Design Token 工作流程**:

1. **设计阶段** (Figma)
   - 设计师在 Figma 中定义颜色、字体、间距
   - 使用 Figma Tokens 插件管理设计 Token
   - 导出 Token 到 JSON 格式

2. **开发阶段** (代码)
   - 开发团队同步 Figma Token 变更
   - 将 Token 转换为 CSS 变量
   - 在代码中使用 Token

**同步工具推荐**:

- [Figma Tokens](https://figmatokens.com/) - Design Token 管理
- [Style Dictionary](https://amzn.github.io/style-dictionary/) - Token 构建工具
- [Theo](https://github.com/salesforce-ux/theo) - Salesforce 的 Token 工具
- [Token Studio](https://tokens.studio/) - Figma Token 插件

**示例 JSON 格式** (从 Figma 导出):

```json
{
  "color": {
    "brand": {
      "primary": { "value": "#409eff" },
      "secondary": { "value": "#00d4ff" }
    },
    "status": {
      "success": { "value": "#67c23a" },
      "warning": { "value": "#e6a23c" },
      "danger": { "value": "#f56c6c" }
    }
  },
  "typography": {
    "fontSize": {
      "sm": { "value": "14px" },
      "base": { "value": "16px" },
      "xl": { "value": "24px" }
    }
  },
  "spacing": {
    "xs": { "value": "8px" },
    "md": { "value": "16px" },
    "lg": { "value": "24px" }
  }
}
```

#### 10.4.6 主题切换支持

**基于 Token 的主题系统**:

```css
/* 默认主题 (深色) - Dark Theme */
:root {
  --color-bg-primary: #1a1a2e;
  --color-text-primary: #e4e4e7;
  /* ... 其他 Token */
}

/* 浅色主题 (可选) - Light Theme */
[data-theme="light"] {
  --color-bg-primary: #ffffff;
  --color-text-primary: #18181b;
  --color-neutral-800: #f5f5f5;
  /* ... 其他 Token */
}

/* 高对比度主题 - High Contrast Theme */
[data-theme="high-contrast"] {
  --color-bg-primary: #000000;
  --color-text-primary: #ffffff;
  --color-border-default: #ffffff;
  /* ... 其他 Token */
}
```

### 10.5 开发规范

#### 10.5.1 CSS 编写规范

1. **使用 CSS 自定义属性（变量）**
   ```css
   /* ✅ 推荐 */
   .card {
     background: var(--card-bg);
     padding: var(--spacing-lg);
   }

   /* ❌ 不推荐 */
   .card {
     background: rgba(26, 26, 46, 0.6);
     padding: 24px;
   }
   ```

2. **遵循 Design Token**
   ```css
   /* ✅ 推荐 - 使用预定义 Token */
   .title {
     font-size: var(--font-size-2xl);
     font-weight: var(--font-weight-semibold);
   }

   /* ❌ 不推荐 - 硬编码值 */
   .title {
     font-size: 32px;
     font-weight: 600;
   }
   ```

3. **保持一致的分层架构**
   ```
   styles/
   ├── abstract/       # 抽象层 (Variables, Functions)
   ├── base/           # 基础层 (Reset, Base)
   ├── components/     # 组件层 (Components)
   ├── pages/          # 页面层 (Pages)
   └── utilities/      # 工具类 (Utilities)
   ```

## 11. 性能优化

### 11.1 已实现优化

1. **路由懒加载**
   ```typescript
   component: () => import('../views/DashboardView.vue')
   ```

2. **计算属性缓存**
   ```typescript
   const eventsByType = computed(() => {
     // 计算逻辑
   });
   ```

3. **图表懒加载**
   - 组件挂载时再初始化ECharts
   - 图表销毁时释放内存

4. **虚拟滚动**
   - 大数据列表使用Element Plus的虚拟滚动
   - 提升渲染性能

### 11.2 优化建议

1. **代码分割**
   - 按路由拆分代码包
   - 使用动态导入

2. **图片优化**
   - 使用WebP格式
   - 图片懒加载

3. **缓存策略**
   - 启用浏览器缓存
   - 合理设置Cache-Control

## 12. 测试

### 12.1 单元测试

暂未配置单元测试，建议使用Vitest进行测试：

```bash
npm install -D vitest @vue/test-utils
```

### 12.2 E2E测试

建议使用Playwright进行端到端测试：

```bash
npm install -D @playwright/test
```

## 13. 部署

### 13.1 构建

```bash
npm run build
```

### 13.2 部署平台

推荐部署平台：
- Vercel
- Netlify
- Cloudflare Pages
- 阿里云OSS

### 13.3 部署配置

**Vercel部署**:
1. 连接Git仓库
2. 自动检测Vite项目
3. 设置环境变量
4. 部署完成

**Netlify部署**:
1. 拖拽dist文件夹或连接Git
2. 构建命令：`npm run build`
3. 发布目录：`dist`

## 14. 常见问题

### 14.1 API调用失败

**问题**: AI分析功能无法使用
**解决**:
1. 检查网络连接
2. 验证API Key是否正确配置
3. 确认API配额是否充足
4. 查看浏览器控制台错误信息

### 14.2 图表不显示

**问题**: ECharts图表空白
**解决**:
1. 检查容器高度是否设置
2. 确认数据格式正确
3. 查看控制台是否有错误
4. 等待数据加载完成

### 14.3 数据上传失败

**问题**: JSON文件上传解析错误
**解决**:
1. 确认JSON格式正确
2. 检查字段是否完整
3. 查看控制台错误信息
4. 参考Mock数据格式

## 15. 开发规范

### 15.1 命名规范

- 文件命名：kebab-case（短横线命名）
- 组件命名：PascalCase（帕斯卡命名）
- 变量命名：camelCase（驼峰命名）
- 常量命名：UPPER_SNAKE_CASE（大写蛇形命名）

### 15.2 代码风格

- 使用2空格缩进
- 行末分号
- 使用单引号
- 使用有意义的变量名
- 添加必要的注释

### 15.3 Git提交规范

```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建过程或辅助工具的变动
```

## 16. 技术亮点

### 16.1 创新功能

1. **流式AI分析**
   - 实时输出分析进度
   - 提升用户体验
   - 支持大模型API调用

2. **智能预警系统**
   - 自动检测异常
   - 规则引擎配置
   - 实时推送通知

3. **数据模拟引擎**
   - 逼真的数据生成
   - 智能关联分析
   - 实时预警触发

### 16.2 技术深度

1. **TypeScript深度应用**
   - 完整的类型定义
   - 严格的类型检查
   - 良好的开发体验

2. **Vue 3组合式API**
   - 逻辑复用
   - 类型推导
   - 更好的性能

3. **ECharts深度定制**
   - 多种图表类型
   - 交互式可视化
   - 实时数据更新

4. **Figma Design System实现**
   - 完整的Design Token体系
   - 设计到代码的无缝衔接
   - 多主题支持（深色/浅色/高对比度）
   - 系统化的颜色、字体、间距管理
   - 基于Figma规范的可复用组件库

5. **现代CSS架构**
   - CSS自定义属性（变量）系统
   - 分层样式架构（ITCSS）
   - 原子化CSS工具类
   - 响应式设计最佳实践

## 17. 未来规划

### 17.1 功能增强

- [ ] WebSocket实时通信
- [ ] 多城市数据支持
- [ ] 历史数据回溯
- [ ] 自定义预警规则
- [ ] 移动端适配优化

### 17.2 技术升级

- [ ] SSR服务端渲染
- [ ] PWA离线支持
- [ ] 微前端架构
- [ ] 单元测试覆盖
- [ ] 性能监控系统

### 17.3 设计系统升级

- [ ] **自动化Design Token同步**
  - 集成Figma Tokens插件
  - CI/CD自动同步设计变更
  - 设计-开发零误差传递

- [ ] **组件库完善**
  - 建立完整的Figma Component库
  - 生成Storybook文档
  - 组件使用示例和代码片段

- [ ] **交互原型系统**
  - 基于Figma的交互原型
  - 动效规范文档
  - 用户体验测试框架

- [ ] **设计资产自动化**
  - 图标自动导出和优化
  - 图片资源自动化处理
  - 设计系统版本管理

- [ ] **多平台设计规范**
  - 桌面端大屏设计规范
  - 移动端适配指南
  - 响应式断点系统完善

- [ ] **设计审查流程**
  - 设计系统Linter
  - UI一致性自动检测
  - 设计规范自动化验证工具

## 18. 贡献指南

### 18.1 贡献流程

1. Fork项目
2. 创建特性分支
3. 提交代码更改
4. 发起Pull Request
5. 代码审查
6. 合并代码

### 18.2 设计贡献指南

如果您想为项目贡献设计资产，请遵循以下指南：

#### 18.2.1 Figma设计资源

**设计文件协作**:
- 项目使用 [Figma](https://figma.com) 作为主要设计工具
- 请确保您的Figma账户有编辑权限
- 所有设计更改应记录在设计文档中

**Design Token贡献**:
1. 在Figma中定义或修改设计Token
2. 使用Figma Tokens插件记录变更
3. 导出Token JSON文件
4. 在PR中说明变更原因和影响范围

**组件设计规范**:
- 遵循8pt网格系统
- 使用预定义的颜色变量
- 确保组件在不同状态下的一致性
- 为新组件创建变体和实例

#### 18.2.2 设计审查流程

**UI设计审查清单**:
- [ ] 遵循设计系统规范
- [ ] 颜色使用符合Token定义
- [ ] 字体大小和间距符合网格
- [ ] 交互状态完整（默认、悬停、激活、禁用）
- [ ] 响应式适配正确
- [ ] 无障碍访问（对比度、标签等）
- [ ] 动画过渡自然

**提交设计资源**:
```bash
# 设计文件更新后需要提交
- figma/design-tokens.json    # 更新的Token文件
- figma/design-changelog.md   # 设计变更日志
- src/styles/tokens/          # 如果有代码更新
```

### 18.3 问题反馈

#### 18.3.1 功能问题反馈

- 提交Issue描述问题
- 提供复现步骤
- 附上错误日志
- 标注环境信息

#### 18.3.2 设计问题反馈

**设计相关Issue模板**:
```
### 设计问题描述
简述设计问题...

### 涉及页面/组件
- 页面：首页/大屏/分析页
- 组件：按钮/卡片/图表

### Figma参考
- Frame链接：[Figma链接]
- 状态：默认/悬停/激活

### 期望效果
描述期望的设计效果...

### 当前效果
描述当前的实现效果...

### 截图
如有截图请附上...
```

**设计资产问题**:
- Figma文件访问权限
- 设计Token同步失败
- 组件样式不一致
- 响应式适配问题
- 动效实现偏差

## 19. 许可证

本项目采用MIT许可证，详情请查看LICENSE文件。

## 20. 联系方式

- 项目维护者：[待补充]
- 邮箱：[待补充]
- 讨论群：[待补充]

---

**开发文档版本**: v1.0
**最后更新**: 2025-11-29
**维护者**: Claude Code